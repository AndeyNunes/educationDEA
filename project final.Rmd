---
title: 'ETM 540 Group Project'
author:
- Samira Akther  
- Jordan Hilton
- Andey Nunes
- Aparna Gandikota
- Mohammed Sheikh
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: pdf_document
---
```{r setup, warning=FALSE, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse, quietly = TRUE)
library(ROI, quietly = TRUE)
library(ROI.plugin.glpk, quietly = TRUE)
library(ompr, quietly = TRUE)
library(ompr.roi, quietly = TRUE)
library(pander, quietly = TRUE)
library(Benchmarking, quietly = TRUE)
library(rDEA, quietly = TRUE)
library(knitr)
library(MultiplierDEA)
library(ggthemes)
library(corrplot)
#library(ggplotify)
#library(plotly)
```

##Methodology

The paper aims to study the efficiency of the education system of OECD (Organization for Economic Development) countries and it examines efficiency by looking at the relationship between certain inputs and outputs. DEA (Data Envelopement Analysis), which is a vastly used tool for measuring efficiency, has been conducted to measure the efficiency of the education system of the countries. 

The basic DEA model is based on constant returns to scale. In our study, we used the model to be based on variable returns to scale on the assumption that every country may not perform in the optimal level. This assumption specifies that as the input is scaled up or down, the output can not be scaled up or down by the same amount.

In our stutdy, our DEA model is based on output-orientation. In the output-oriented model, the focus of the model is on increasing the output while holding the input as observed in studied units. We assumed that each country has a given fund for spending on education which is influened by various factors including the GDP,budget and political factors.

In a DEA model, the efficiency of a DEcision making unit (DMU) is actually a relative efficiency which is determined by comparing the studied unit's abilty in producing output with a target. In our study, DMU is a country's education system. The objective here is to find the efficiency of this education system in making educational achievements using the resources invested in the system.

Now, consider  $n$ number of education system $DMUj$  which consumes $x_{i,j}$ inputs and produce $y_{r,j}$ output. The education system operates in variable returns to scale. So this output oriented model can be expressed by a linear algebric model where the objective will be to maximize the efficiency scores of _j_ education system. The efficiency scores can be defined by $$\phi$$



$$
 \begin{split}
 \begin{aligned}
 \text{Max  }   & \phi \\
  \text{subject to }\ & \sum_{j=1}^{n} x_{i,j}\lambda_j \leq x_{i,k} \; \forall \; i \\
                      & \sum_{j=1}^{n} y_{r,j}\lambda_j \geq  \phi_{r,k} \; \forall \; r \\
                      & \lambda_j \geq 0  \; \forall \; j\\
                      & \sum_{j=1}^{n}\lambda_j=1
  \end{aligned}
  \end{split}
$$

Here, a country's education system is considered efficient if the efficeincy score  $$\phi$$ is 1. The country with score of 1 lies in the efficient frontier which is a linear combination of all the countries with efficiency scores of 1. The countries with scores less than 1 will be considered as relatively inefficient in comparison to the target specified by $$\lambda$$. The vector $$\lambda$$ is specific amount of a unit _j_ used in setting the target for performance for studied unit _k_. To accomodate the variable returns to scale of our studied input and output, a constarint that $$\lambda$$ sums up to 1 is added to the model. Also, as it is a output oriented model, the first (input) constraint will be satisfied while trying to exceed the second constraint (output) by as much possible. 

## Data 
The discussed methodology has been used to perform three DEA model and analysis and thus have a better understanding of the efficiency of the education system of the countries.We considered 32 OECD countries eliminating those which does not have all the data points. 

For inputs, we considered each country's education spending per student in US dollars. Per student data will help us to eliminate the size effect of a country with large GDP and thus large budget for education. In the third model, we also incorporate data about teaching hours..........

As our goal is to find the efficiency of the ecountry's education system, we decided to use PISA score as measumement of success. PISA is widely recognized performance yardstick to assess the competency of a country's school system. PISA focus on three segment: reading, mathematic and science. So there are different scores and each one is considered as an output in our DEA model. Two of our DEA model also considered average of these three scores as an output. In addition to PISA scores, one of our model have been incorporated tertiary graduation rate. 

Data has been obtained from secondary sources. Data on PISA scores were obtained from OECD website. Data on public education spending per student and tertiary graduation rate were obtained from UNESCO website. Data on teaching hours were collected from ....... 

Here is a summary of the data.


```{r load}
## load our data, downloaded from the google sheet
data <- read.csv("OECDdata.csv", stringsAsFactors = F)

glimpse(data)
```

We can see that there are three observations missing from several of the population education level fields and three zero values for `Total Spending`. These countries (listed below) will be excluded from the analysis.


```{r data cleaning}

data$Total.Spending <- as.numeric(gsub(",", "", data$Total.Spending))
data$Spending.as.percentage.of.GDP <- as.numeric(gsub("%", "", data$Spending.as.percentage.of.GDP))

# remove 0 spending countries
DEAdata <- data %>%
   filter(Total.Spending > 0)

setdiff(data[,1], DEAdata[,1])

```



# DEA Model
## Part A: Single input, single output

For this first part, we will set up and solve a DEA model using the single GDP data point for the input and the aggregated test score average for the single output.

Run a DEA with a single input (total education spending) and a single output (Average PISA score)
```{r run single dea}
#this is single input and single output
x <- DEAdata %>% select(Total.Spending) ## input
#x2 <- data %>% select(Spending.as.percentage.of.GDP) ## ratio input used in next section
y <- DEAdata %>% select(AveragePISA) ## output
row.names(x) <- DEAdata$Countries #%>%
   
row.names(y) <- DEAdata$Countries


ressingle <- DeaMultiplierModel(x, y, rts = "vrs", orientation = "output")

efficiencyTable <- tibble(
   country = as.character(dimnames(ressingle$Efficiency)[[1]]),
   efficiency = as.numeric(ressingle$Efficiency)) %>%
   arrange(desc(efficiency))

pander(head(efficiencyTable), caption = "DEA Output Efficiency for Aggregate Scores")
pander(head(ressingle$Lambda), caption = "DEA lambda values for Aggregate Scores")

```



```{r single output plot}
dea.plot(x = x, y = y, txt = dimnames(x)[[1]], GRID = T,
         xlab = "Total Spending", ylab = "Average PISA",
         ylim = c(400,550), main = "2015 OECD data DEA plot")
```



```{r hand drawn frontier, include=F, eval=F}
# warning, the geom_segment calls are not reproducible and must be hand specified
ggplot(DEAdata, aes(x = Total.Spending, y  = AveragePISA)) +
   geom_point() +
   geom_text(aes(label = Countries), size = 3,
             nudge_x = 2, nudge_y = -1.5, color = "gray40") +
   geom_segment(aes(x = 40, y = 529, xend = 25, yend = 528.67), color = "dodgerblue") +
   geom_segment(aes(x = 25, y = 528.67, xend = 7, yend = 523.67), color = "dodgerblue") +
   geom_segment(aes(x = 7, y = 523.67, xend = 1, yend = 506.33), color = "dodgerblue") +
   geom_segment(aes(x = 1, y = 506.33, xend = 1, yend = 504.33), color = "dodgerblue") +
   geom_segment(aes(x = 1, y = 504.33, xend = 1, yend = 400), color = "dodgerblue") +
   #geom_segment(aes(x = 11, y = 524.33, xend = 1, yend = 506.33), color = "lightblue") +
   theme_minimal() +
   ggtitle("DEA plot of 2015 OECD Countries",
           subtitle = "Average Education Scores by Total Spending")
```

## Part B: 
Run a DEA with a single input, but multiple outputs:
```{r runmultipledea}
#this is single input and multiple output
y <- DEAdata %>% select(SciencePISA, ReadingPISA, MathematicsPISA) ## output
row.names(y) <- DEAdata[,1]

resmult <- DeaMultiplierModel(x, y, rts = "vrs", orientation = "output")

multEfficiencyTable <- tibble(
   country = as.character(dimnames(resmult$Efficiency)[[1]]),
   efficiency = as.numeric(resmult$Efficiency)) %>%
   arrange(desc(efficiency))
```


```{r inspect resmult}
pander(head(multEfficiencyTable, 10), caption = "DEA Output Efficency for Multiple Scores")
pander(head(resmult$Lambda), caption = "DEA lambda values for Multiple Scores")
```


```{r multiple output plot}
dea.plot(x = x, y = y, txt = dimnames(x)[[1]], GRID = T,
         xlab = "Total Spending", ylab = "Multiple PISA",
         ylim = c(1200,1600), main = "2015 OECD data DEA plot")
```


```{r hand drawn multiple output frontier, include=F, eval=F}
# warning, the geom_segment calls are not reproducible and must be hand specified
data$multPISA <- data$SciencePISA + data$ReadingPISA + data$MathematicsPISA
data$country <- data$Countries

ggplot(data, aes(x = Total.Spending, y  = multPISA)) +
   geom_point() +
   geom_text(aes(label = Countries), size = 3,
             nudge_x = 2, nudge_y = -1.5, color = "gray40") +
   geom_segment(aes(x = 40, y = 1586, xend = 25, yend = 1586), color = "dodgerblue") +
   geom_segment(aes(x = 25, y = 1586, xend = 7, yend = 1571), color = "dodgerblue") +
   geom_segment(aes(x = 7, y = 1571, xend = 1, yend = 1519), color = "dodgerblue") +
   geom_segment(aes(x = 1, y = 1519, xend = 1, yend = 1200), color = "dodgerblue") +
   theme_minimal() +
   ggtitle("DEA plot of 2015 OECD Countries",
           subtitle = "Multiple Education Scores by Total Spending")
```



## Part C: Results and discussion

Some quick analysis of the results:

```{r quickanalysis}
max(ressingle$Efficiency) ## the maximum efficiency for one output
which.max(ressingle$Efficiency) ## the row value of the maximum efficiency
data[33, ] ## the row from the data matching the answers above
min(ressingle$Efficiency) ##same for mins
which.min(ressingle$Efficiency)
data[22,]
ressingle$Efficiency["United States",] ## US efficiency

max(resmult$Efficiency) ## the maximum efficiency for one output
which.max(resmult$Efficiency) ## the row value of the maximum efficiency
data[4, ]
min(resmult$Efficiency) ##same for mins
which.min(resmult$Efficiency)
data[14,]
```

# References

### Data Sources

All data sourced from https://data.oecd.org/

Anderson, T. R. (2019) Operations Research Using R 

Anderson, T. R. (2019) Data Envelopment Analysis Using R

Bogetoft, P., Otto, L. (2011) Benchmarking with DEA, SFS, and R. Springer. 

# Appendix

